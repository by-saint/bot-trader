<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MB Sniper Quantum-Vortex | Deep Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        
        :root { --accent: #6366f1; --bg: #020204; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg); color: #f8fafc; overflow-x: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Glassmorphism effects */
        .glass { background: rgba(10, 10, 18, 0.7); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .glow-indigo { box-shadow: 0 0 40px -10px rgba(99, 102, 241, 0.3); }
        
        /* Scanning Animation */
        .scan-bar { height: 2px; background: linear-gradient(90deg, transparent, var(--accent), transparent); width: 100%; position: absolute; z-index: 10; animation: scanning 4s linear infinite; }
        @keyframes scanning { 0% { top: 0; } 100% { top: 100%; } }

        /* Typography */
        .h-gradient { background: linear-gradient(135deg, #fff 0%, #6366f1 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // --- CONSTANTS ---
        const apiKey = ""; // API Key provided by the environment
        const MB_WHITELIST = [
            'BTC', 'ETH', 'SOL', 'XRP', 'ADA', 'DOT', 'LINK', 'AVAX', 'MATIC', 'LTC', 
            'BCH', 'DOGE', 'SHIB', 'NEAR', 'ALGO', 'ATOM', 'UNI', 'AAVE', 'SAND',
            'MANA', 'GRT', 'CHZ', 'AXS', 'RENDER', 'FETCH', 'PEPE', 'STX', 'TIA', 'BONK', 'FLOKI'
        ];

        const ENGINE_PARAMS = {
            FEE_MB: 0.014, // 1.4% (Buy+Sell)
            SAFETY_MARGIN: 0.005, // 0.5% extra buffer
            MIN_SCORE: 90, // Strictness for AI validation
            CHECK_RATE: 60000 // 1 minute
        };

        const App = () => {
            const [signals, setSignals] = useState([]);
            const [loading, setLoading] = useState(true);
            const [usdtBrl, setUsdtBrl] = useState(0);
            const [status, setStatus] = useState('CALIBRATING');
            const [timer, setTimer] = useState(60);

            // --- AI INFERENCE ENGINE ---
            const validateWithAI = async (symbol, data) => {
                const prompt = `Analyze the last 20 candles of ${symbol}: ${JSON.stringify(data)}.
                Perform a Deep Market Structure analysis. Check for Wyckoff accumulation or Spring patterns.
                Return ONLY a JSON object: 
                {"decision": "LONG" | "HOLD", "confidence": 0-100, "eta_minutes": number, "structure": "string description"}`;

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    });
                    const result = await response.json();
                    return JSON.parse(result.candidates?.[0]?.content?.parts?.[0]?.text);
                } catch (e) {
                    console.error("AI Node Failure", e);
                    return null;
                }
            };

            // --- QUANTUM ENGINE LOGIC ---
            const analyzeMarketDepth = (k5, k15, k1h) => {
                const closes = k15.map(k => parseFloat(k[4]));
                const current = closes[closes.length - 1];
                
                // 1. Chaikin Money Flow (Accumulation check)
                const adl = k15.map(k => {
                    const h = parseFloat(k[2]), l = parseFloat(k[3]), c = parseFloat(k[4]), v = parseFloat(k[5]);
                    return ((c - l) - (h - c)) / (h - l || 1) * v;
                });
                const cmf = adl.slice(-20).reduce((a, b) => a + b, 0) / k15.slice(-20).reduce((a, b) => a + parseFloat(b[5]), 0);

                // 2. Hull Moving Average (Trend)
                const sma200 = k1h.slice(-200).reduce((a, b) => a + parseFloat(b[4]), 0) / 200;
                
                // 3. Volatility Check (ATR)
                const tr = k15.slice(-14).map((k, i) => {
                    if (i === 0) return parseFloat(k[2]) - parseFloat(k[3]);
                    const prevC = parseFloat(k15[i-1][4]);
                    return Math.max(parseFloat(k[2]) - parseFloat(k[3]), Math.abs(parseFloat(k[2]) - prevC), Math.abs(parseFloat(k[3]) - prevC));
                });
                const atr = tr.reduce((a, b) => a + b, 0) / 14;

                // Technical Probability Score
                let score = 0;
                if (current > sma200) score += 30; // Macro Up
                if (cmf > 0.1) score += 30;     // Money entering
                if (current < sma200 * 1.05) score += 40; // Buying near support

                return { current, atr, score, cmf };
            };

            const runEngine = useCallback(async () => {
                setStatus('SCANNING');
                try {
                    const [uRes, tRes] = await Promise.all([
                        fetch('https://api.binance.com/api/v3/ticker/price?symbol=USDTBRL').then(r => r.json()),
                        fetch('https://api.binance.com/api/v3/ticker/24hr').then(r => r.json())
                    ]);
                    
                    const dollar = parseFloat(uRes.price);
                    setUsdtBrl(dollar);

                    const candidates = tRes.filter(t => MB_WHITELIST.includes(t.symbol.replace('USDT', '')) && parseFloat(t.quoteVolume) > 5000000);
                    const validSignals = [];

                    for (const cand of candidates.slice(0, 12)) {
                        const symbol = cand.symbol;
                        setStatus(`ANALYZING ${symbol}`);
                        
                        const [k5, k15, k1h] = await Promise.all([
                            fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=5m&limit=50`).then(r => r.json()),
                            fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=15m&limit=50`).then(r => r.json()),
                            fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1h&limit=200`).then(r => r.json())
                        ]);

                        const tech = analyzeMarketDepth(k5, k15, k1h);

                        if (tech.score >= 70) {
                            // IA Validation Step
                            const ai = await validateWithAI(symbol, k15.slice(-20));
                            
                            if (ai && ai.decision === "LONG" && ai.confidence > ENGINE_PARAMS.MIN_SCORE) {
                                const target = tech.current + (tech.atr * 2.5);
                                const grossProfit = (target / tech.current) - 1;
                                const netProfit = (grossProfit - ENGINE_PARAMS.FEE_MB - ENGINE_PARAMS.SAFETY_MARGIN) * 100;

                                if (netProfit > 1.0) {
                                    validSignals.push({
                                        coin: symbol.replace('USDT', ''),
                                        score: ai.confidence,
                                        priceBRL: tech.current * dollar,
                                        targetBRL: target * dollar,
                                        stopBRL: (tech.current - (tech.atr * 1.5)) * dollar,
                                        eta: ai.eta_minutes + " min",
                                        reason: ai.structure,
                                        netProfit: netProfit.toFixed(2)
                                    });
                                }
                            }
                        }
                    }

                    setSignals(validSignals.sort((a, b) => b.score - a.score));
                    setLoading(false);
                    setStatus('IDLE');
                } catch (e) {
                    console.error(e);
                    setStatus('ERROR');
                }
            }, []);

            useEffect(() => {
                runEngine();
                const timerInt = setInterval(() => setTimer(t => t <= 1 ? 60 : t - 1), 1000);
                const syncInt = setInterval(runEngine, ENGINE_PARAMS.CHECK_RATE);
                return () => { clearInterval(timerInt); clearInterval(syncInt); };
            }, [runEngine]);

            const fmt = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', minimumFractionDigits: v < 1 ? 4 : 2 });

            return (
                <div className="max-w-7xl mx-auto p-4 lg:p-12 relative min-h-screen">
                    {/* Header Terminal */}
                    <div className="glass glow-indigo rounded-[40px] p-8 mb-12 relative overflow-hidden">
                        <div className="scan-bar opacity-20"></div>
                        <div className="flex flex-col lg:flex-row justify-between items-center gap-8 relative z-20">
                            <div className="flex items-center gap-6">
                                <div className="p-4 bg-indigo-600/20 rounded-2xl border border-indigo-500/30">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#6366f1" strokeWidth="2.5"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                                </div>
                                <div>
                                    <h1 className="text-3xl font-black h-gradient tracking-tighter uppercase">Quantum-Vortex <span className="text-white opacity-50 text-xl font-light">Deep AI</span></h1>
                                    <p className="text-[10px] mono text-slate-500 uppercase tracking-[0.3em] flex items-center gap-2 mt-1">
                                        <span className="w-2 h-2 bg-indigo-500 rounded-full animate-ping"></span>
                                        Engine Status: {status} | BRL Rate: R$ {usdtBrl.toFixed(2)}
                                    </p>
                                </div>
                            </div>
                            <div className="flex items-center gap-12">
                                <div className="text-right">
                                    <p className="text-[10px] font-bold text-slate-600 uppercase tracking-widest mb-1">Recalibragem em</p>
                                    <p className="text-4xl font-black text-white mono">{timer}s</p>
                                </div>
                                <button onClick={() => {setLoading(true); runEngine();}} className="p-4 bg-white/5 hover:bg-white/10 rounded-2xl border border-white/10 transition-all">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-10">
                        {/* Feed de Inteligência */}
                        <div className="lg:col-span-8 space-y-8">
                            {loading ? (
                                <div className="glass p-32 rounded-[50px] text-center border-indigo-500/10">
                                    <div className="w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto mb-8"></div>
                                    <p className="text-xs font-bold text-slate-500 tracking-[0.6em] uppercase italic">Sincronizando com Nós de IA...</p>
                                </div>
                            ) : signals.length === 0 ? (
                                <div className="glass p-20 rounded-[50px] text-center border-dashed border-white/5 opacity-50">
                                    <p className="text-slate-500 italic text-sm">Nenhuma anomalia institucional detectada. Aguardando confluência multitemporal.</p>
                                </div>
                            ) : (
                                signals.map((s, i) => (
                                    <div key={i} className="glass rounded-[50px] p-10 relative overflow-hidden group hover:border-indigo-500/50 transition-all">
                                        <div className="absolute top-0 right-0 p-10 text-right z-10">
                                            <p className="text-[9px] font-black text-slate-600 uppercase mb-1 tracking-tighter">Probabilidade de Sucesso</p>
                                            <div className="text-6xl font-black text-indigo-500 opacity-20 group-hover:opacity-60 transition-all italic">{s.score}%</div>
                                        </div>

                                        <div className="flex items-center gap-8 mb-12 relative z-10">
                                            <div className="w-20 h-20 bg-gradient-to-br from-indigo-600 to-indigo-950 rounded-[30px] flex items-center justify-center text-4xl font-black text-white shadow-2xl">
                                                {s.coin[0]}
                                            </div>
                                            <div>
                                                <h3 className="text-5xl font-black text-white tracking-tighter uppercase">{s.coin}</h3>
                                                <div className="flex gap-4 mt-3">
                                                    <div className="bg-emerald-500/10 border border-emerald-500/20 px-4 py-1.5 rounded-full">
                                                        <span className="text-[10px] font-black text-emerald-400 uppercase tracking-widest">Lucro Líquido: +{s.netProfit}%</span>
                                                    </div>
                                                    <div className="bg-white/5 border border-white/10 px-4 py-1.5 rounded-full">
                                                        <span className="text-[10px] font-black text-indigo-400 uppercase tracking-widest flex items-center gap-2">
                                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                                            Tempo Est.: {s.eta}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12 relative z-10">
                                            <PriceBlock label="Compra Sugerida (BRL)" val={fmt(s.priceBRL)} active={true} />
                                            <PriceBlock label="Alvo de Saída IA" val={fmt(s.targetBRL)} color="text-indigo-400" />
                                            <PriceBlock label="Proteção de Capital" val={fmt(s.stopBRL)} color="text-red-500" />
                                        </div>

                                        <div className="flex flex-col lg:flex-row justify-between items-center gap-6 pt-10 border-t border-white/5 relative z-10">
                                            <div className="max-w-md">
                                                <p className="text-[10px] font-black text-slate-600 uppercase tracking-[0.2em] mb-2 flex items-center gap-2">
                                                    <div className="w-1.5 h-1.5 bg-indigo-500 rounded-full"></div>
                                                    Análise Estrutural Gemini
                                                </p>
                                                <p className="text-[11px] text-slate-400 italic leading-relaxed">"{s.reason}"</p>
                                            </div>
                                            <a href={`https://www.mercadobitcoin.com.br/negociacoes/${s.coin.toLowerCase()}`} target="_blank" className="w-full lg:w-auto bg-white text-black font-black text-xs px-16 py-5 rounded-[25px] hover:bg-indigo-600 hover:text-white transition-all uppercase tracking-[0.3em] shadow-2xl text-center">Executar no MB</a>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>

                        {/* Intelligence Sidebar */}
                        <div className="lg:col-span-4 space-y-8">
                            <div className="glass p-10 rounded-[50px] border-indigo-500/20">
                                <h3 className="text-xs font-black text-white mb-10 uppercase italic tracking-widest flex items-center gap-3">
                                    <div className="w-3 h-3 bg-indigo-500 rounded-full shadow-[0_0_10px_#6366f1]"></div>
                                    Vortex Protocol v5.2
                                </h3>
                                <div className="space-y-10">
                                    <IntelItem title="Inferência Gemini 2.5" text="Nossos servidores de IA processam a micro-estrutura do gráfico buscando por 'Bull Traps' e 'Short Squeezes' antes de validar." />
                                    <IntelItem title="Venda por ATR" text="O lucro não é fixo. Ele é calculado baseado na volatilidade histórica da moeda. Se a moeda corre mais, buscamos mais lucro." />
                                    <IntelItem title="Taxa Absorvida" text="O robô calcula as taxas de 0.7% buy/sell do Mercado Bitcoin e só libera o sinal se o lucro real for maior que 1% limpo." />
                                </div>
                            </div>

                            <div className="bg-gradient-to-br from-indigo-900/30 to-black p-10 rounded-[50px] border border-indigo-500/20 shadow-2xl relative overflow-hidden">
                                <div className="absolute top-0 right-0 w-32 h-32 bg-indigo-500/10 rounded-full blur-2xl"></div>
                                <h4 className="text-[10px] font-black text-white uppercase tracking-widest text-center mb-4">Proteção Institucional</h4>
                                <p className="text-[11px] text-slate-500 italic text-center leading-relaxed">Filtro de liquidez de $5M USD/24h. Isso garante que sua ordem no Mercado Bitcoin não sofra derrapagem severa.</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const PriceBlock = ({ label, val, color = "text-white", active = false }) => (
            <div className={`p-6 rounded-[35px] border ${active ? 'bg-indigo-600/10 border-indigo-500/30' : 'bg-white/[0.02] border-white/5'} transition-all`}>
                <p className="text-[9px] font-black text-slate-600 uppercase mb-3 tracking-widest italic">{label}</p>
                <p className={`text-2xl font-mono font-bold tracking-tighter ${color}`}>{val}</p>
            </div>
        );

        const IntelItem = ({ title, text }) => (
            <div className="relative pl-8 border-l-2 border-indigo-500/20">
                <div className="absolute -left-[9px] top-0 w-4 h-4 bg-indigo-500 rounded-full border-4 border-[#020204]"></div>
                <h4 className="text-xs font-black text-white uppercase italic tracking-tighter">{title}</h4>
                <p className="text-[11px] text-slate-500 mt-3 leading-relaxed font-medium">{text}</p>
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
