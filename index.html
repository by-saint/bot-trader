<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MB Sniper Quantum-Vortex | NEXUS ELITE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        
        :root { --accent: #818cf8; --bg: #030306; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg); color: #f8fafc; overflow-x: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        .glass { background: rgba(13, 13, 22, 0.75); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .glow-indigo { box-shadow: 0 0 50px -10px rgba(99, 102, 241, 0.4); }
        
        .scan-bar { height: 2px; background: linear-gradient(90deg, transparent, #818cf8, transparent); width: 100%; position: absolute; z-index: 10; animation: scanning 3s linear infinite; }
        @keyframes scanning { 0% { top: 0; } 100% { top: 100%; } }

        .h-gradient { background: linear-gradient(135deg, #fff 30%, #818cf8 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .progress-bar { height: 3px; background: #818cf8; transition: width 0.3s ease; box-shadow: 0 0 10px #818cf8; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // --- EXPANDED RELIABLE WHITELIST (MERCADO BITCOIN COMPATIBLE) ---
        const MB_WHITELIST = [
            'BTC', 'ETH', 'SOL', 'XRP', 'ADA', 'DOT', 'LINK', 'AVAX', 'MATIC', 'LTC', 
            'BCH', 'DOGE', 'SHIB', 'NEAR', 'ALGO', 'ATOM', 'UNI', 'AAVE', 'SAND',
            'MANA', 'GRT', 'CHZ', 'AXS', 'RENDER', 'FETCH', 'PEPE', 'STX', 'TIA', 
            'BONK', 'FLOKI', 'OP', 'ARB', 'SUI', 'APT', 'IMX', 'LDO', 'FET', 'VET', 
            'FIL', 'ETC', 'INJ', 'RNDR', 'SEI', 'KAS', 'BEAM', 'GALA', 'ROSE', 'JUP'
        ];

        const ENGINE_PARAMS = {
            FEE_MB: 0.014, 
            SAFETY_MARGIN: 0.006, 
            MIN_SCORE: 88, 
            CHECK_RATE: 60000 
        };

        const App = () => {
            const [signals, setSignals] = useState([]);
            const [loading, setLoading] = useState(true);
            const [usdtBrl, setUsdtBrl] = useState(0);
            const [status, setStatus] = useState('CALIBRATING');
            const [timer, setTimer] = useState(60);
            const [progress, setProgress] = useState(0);

            // --- DEEP AI VALIDATION ---
            const validateWithAI = async (symbol, data, techScore) => {
                const prompt = `Ativo: ${symbol}. Dados: ${JSON.stringify(data)}. Pontuação Técnica: ${techScore}.
                Execute uma análise Nexus-Elite. Identifique se este é um 'Liquidity Trap' ou um rompimento real.
                Retorne APENAS um JSON: {"decision": "LONG" | "HOLD", "confidence": 0-100, "target_multiplier": number, "eta_minutes": number, "insight": "string"}`;

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    });
                    const result = await response.json();
                    return JSON.parse(result.candidates?.[0]?.content?.parts?.[0]?.text);
                } catch (e) {
                    return null;
                }
            };

            // --- ADVANCED TECHNICAL PRE-FILTER ---
            const preFilterTechnical = (k15, k1h) => {
                const closes = k15.map(k => parseFloat(k[4]));
                const current = closes[closes.length - 1];
                
                // 1. Médias Institucionais
                const sma200 = k1h.slice(-200).reduce((a, b) => a + parseFloat(b[4]), 0) / 200;
                const ema50 = closes.slice(-50).reduce((a, b) => a + b, 0) / 50;

                // 2. Bollinger Band Squeeze Detection
                const avg = closes.slice(-20).reduce((a, b) => a + b, 0) / 20;
                const stdDev = Math.sqrt(closes.slice(-20).map(x => Math.pow(x - avg, 2)).reduce((a, b) => a + b) / 20);
                const upperBB = avg + (stdDev * 2);
                const lowerBB = avg - (stdDev * 2);
                const squeeze = (upperBB - lowerBB) / avg;

                // 3. Chaikin Money Flow
                const adl = k15.slice(-20).map(k => {
                    const h = parseFloat(k[2]), l = parseFloat(k[3]), c = parseFloat(k[4]), v = parseFloat(k[5]);
                    return ((c - l) - (h - c)) / (h - l || 1) * v;
                });
                const cmf = adl.reduce((a, b) => a + b, 0) / k15.slice(-20).reduce((a, b) => a + parseFloat(b[5]), 0);

                // NEXUS Technical Score
                let score = 0;
                if (current > sma200) score += 30; // Macro Up
                if (current > ema50) score += 20;  // Momentum Up
                if (cmf > 0.05) score += 25;      // Injeção de capital
                if (squeeze < 0.05) score += 25;   // Compressão antes da explosão

                // Volatility (ATR)
                const tr = k15.slice(-14).map((k, i) => {
                    const prevC = i === 0 ? parseFloat(k[3]) : parseFloat(k15[i-1][4]);
                    return Math.max(parseFloat(k[2]) - parseFloat(k[3]), Math.abs(parseFloat(k[2]) - prevC), Math.abs(parseFloat(k[3]) - prevC));
                });
                const atr = tr.reduce((a, b) => a + b, 0) / 14;

                return { current, atr, score, isGood: score >= 50 };
            };

            const runEngine = useCallback(async () => {
                setStatus('INITIALIZING SCAN');
                setProgress(5);
                try {
                    const [uRes, tRes] = await Promise.all([
                        fetch('https://api.binance.com/api/v3/ticker/price?symbol=USDTBRL').then(r => r.json()),
                        fetch('https://api.binance.com/api/v3/ticker/24hr').then(r => r.json())
                    ]);
                    
                    const dollar = parseFloat(uRes.price);
                    setUsdtBrl(dollar);

                    const allTickers = tRes.filter(t => MB_WHITELIST.includes(t.symbol.replace('USDT', '')) && parseFloat(t.quoteVolume) > 3000000);
                    const validSignals = [];
                    
                    const totalSteps = allTickers.length;
                    
                    for (let i = 0; i < allTickers.length; i++) {
                        const cand = allTickers[i];
                        const symbol = cand.symbol;
                        setStatus(`SCANNING ${symbol}`);
                        setProgress(Math.round((i / totalSteps) * 90) + 5);
                        
                        // Busca dados multitemporais
                        const [k15, k1h] = await Promise.all([
                            fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=15m&limit=50`).then(r => r.json()),
                            fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1h&limit=200`).then(r => r.json())
                        ]);

                        const tech = preFilterTechnical(k15, k1h);

                        // Apenas envia para a IA se passar no filtro técnico Nexus
                        if (tech.isGood) {
                            const ai = await validateWithAI(symbol, k15.slice(-15), tech.score);
                            
                            if (ai && ai.decision === "LONG" && ai.confidence > ENGINE_PARAMS.MIN_SCORE) {
                                const targetMultiplier = ai.target_multiplier || 2.5;
                                const target = tech.current + (tech.atr * targetMultiplier);
                                const netProfit = ((target / tech.current) - 1 - ENGINE_PARAMS.FEE_MB - ENGINE_PARAMS.SAFETY_MARGIN) * 100;

                                if (netProfit > 1.2) {
                                    validSignals.push({
                                        coin: symbol.replace('USDT', ''),
                                        score: ai.confidence,
                                        priceBRL: tech.current * dollar,
                                        targetBRL: target * dollar,
                                        stopBRL: (tech.current - (tech.atr * 1.6)) * dollar,
                                        eta: ai.eta_minutes + " min",
                                        reason: ai.insight,
                                        netProfit: netProfit.toFixed(2)
                                    });
                                }
                            }
                        }
                    }

                    setSignals(validSignals.sort((a, b) => b.score - a.score));
                    setLoading(false);
                    setStatus('IDLE');
                    setProgress(100);
                } catch (e) {
                    setStatus('ERROR IN NODE');
                }
            }, []);

            useEffect(() => {
                runEngine();
                const timerInt = setInterval(() => setTimer(t => t <= 1 ? 60 : t - 1), 1000);
                const syncInt = setInterval(runEngine, ENGINE_PARAMS.CHECK_RATE);
                return () => { clearInterval(timerInt); clearInterval(syncInt); };
            }, [runEngine]);

            const fmt = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', minimumFractionDigits: v < 1 ? 4 : 2 });

            return (
                <div className="max-w-7xl mx-auto p-4 lg:p-12 relative min-h-screen">
                    {/* Progress Bar Top */}
                    <div className="fixed top-0 left-0 w-full z-50 overflow-hidden h-1">
                        <div className="progress-bar" style={{width: `${progress}%`}}></div>
                    </div>

                    {/* Header Terminal */}
                    <div className="glass glow-indigo rounded-[40px] p-8 mb-12 relative overflow-hidden">
                        <div className="scan-bar opacity-20"></div>
                        <div className="flex flex-col lg:flex-row justify-between items-center gap-8 relative z-20">
                            <div className="flex items-center gap-6">
                                <div className="p-4 bg-indigo-600/20 rounded-2xl border border-indigo-500/30">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#818cf8" strokeWidth="2.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                                </div>
                                <div>
                                    <h1 className="text-3xl font-black h-gradient tracking-tighter uppercase leading-none">Nexus-Elite <span className="text-white opacity-40 text-lg font-light tracking-normal">Quantum Scan</span></h1>
                                    <p className="text-[10px] mono text-slate-500 uppercase tracking-[0.3em] flex items-center gap-2 mt-2">
                                        <span className="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span>
                                        {status} | BRL Rate: R$ {usdtBrl.toFixed(2)}
                                    </p>
                                </div>
                            </div>
                            <div className="flex items-center gap-12">
                                <div className="text-right">
                                    <p className="text-[9px] font-bold text-slate-600 uppercase tracking-widest mb-1">Novo Ciclo</p>
                                    <p className="text-4xl font-black text-white mono leading-none">{timer}s</p>
                                </div>
                                <button onClick={() => {setLoading(true); runEngine();}} className="p-4 bg-white/5 hover:bg-white/10 rounded-2xl border border-white/10 transition-all active:scale-95">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-10">
                        {/* Feed Principal */}
                        <div className="lg:col-span-8 space-y-8">
                            {loading ? (
                                <div className="glass p-32 rounded-[50px] text-center border-indigo-500/10 relative overflow-hidden">
                                    <div className="scan-bar opacity-10"></div>
                                    <div className="w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto mb-8"></div>
                                    <p className="text-[10px] font-black text-slate-500 tracking-[0.6em] uppercase animate-pulse">Analisando 50+ Ativos Institucionais...</p>
                                </div>
                            ) : signals.length === 0 ? (
                                <div className="glass p-20 rounded-[50px] text-center border-dashed border-white/10 opacity-60">
                                    <p className="text-slate-500 italic text-sm">O mercado não apresenta a confluência Nexus necessária no momento. Protegendo capital.</p>
                                </div>
                            ) : (
                                signals.map((s, i) => (
                                    <div key={i} className="glass rounded-[50px] p-10 relative overflow-hidden group hover:border-indigo-400/50 transition-all shadow-2xl">
                                        <div className="absolute top-0 right-0 p-10 text-right z-10">
                                            <div className="text-[9px] font-black text-slate-600 uppercase mb-1 tracking-tighter">Nexus Confidence</div>
                                            <div className="text-6xl font-black text-indigo-400 opacity-20 group-hover:opacity-100 transition-all italic">{s.score}%</div>
                                        </div>

                                        <div className="flex items-center gap-8 mb-12 relative z-10">
                                            <div className="w-20 h-20 bg-gradient-to-br from-indigo-500 to-indigo-950 rounded-[30px] flex items-center justify-center text-4xl font-black text-white shadow-2xl border border-white/10">
                                                {s.coin[0]}
                                            </div>
                                            <div>
                                                <h3 className="text-5xl font-black text-white tracking-tighter uppercase italic">{s.coin}</h3>
                                                <div className="flex gap-4 mt-4">
                                                    <div className="bg-emerald-500/10 border border-emerald-500/20 px-4 py-2 rounded-2xl">
                                                        <span className="text-[10px] font-black text-emerald-400 uppercase tracking-widest flex items-center gap-2">
                                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
                                                            LUCRO LÍQUIDO: +{s.netProfit}%
                                                        </span>
                                                    </div>
                                                    <div className="bg-white/5 border border-white/10 px-4 py-2 rounded-2xl">
                                                        <span className="text-[10px] font-black text-indigo-400 uppercase tracking-widest flex items-center gap-2">
                                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                                            ETA: {s.eta}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12 relative z-10">
                                            <PriceBlock label="Ponto de Entrada (BRL)" val={fmt(s.priceBRL)} active={true} />
                                            <PriceBlock label="Saída Institucional" val={fmt(s.targetBRL)} color="text-indigo-400" />
                                            <PriceBlock label="Hard Stop (Proteção)" val={fmt(s.stopBRL)} color="text-red-500" />
                                        </div>

                                        <div className="flex flex-col lg:flex-row justify-between items-center gap-8 pt-10 border-t border-white/5 relative z-10">
                                            <div className="flex-1">
                                                <div className="flex items-center gap-2 mb-3">
                                                    <div className="w-1.5 h-1.5 bg-indigo-500 rounded-full"></div>
                                                    <p className="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em]">IA Nexus Insight</p>
                                                </div>
                                                <p className="text-xs text-slate-400 italic leading-relaxed border-l-2 border-indigo-500/30 pl-4">"{s.reason}"</p>
                                            </div>
                                            <a href={`https://www.mercadobitcoin.com.br/negociacoes/${s.coin.toLowerCase()}`} target="_blank" className="w-full lg:w-auto bg-white text-black font-black text-xs px-16 py-5 rounded-[22px] hover:bg-indigo-600 hover:text-white transition-all uppercase tracking-[0.3em] shadow-2xl text-center active:scale-95">Executar no MB</a>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>

                        {/* Intelligence Sidebar */}
                        <div className="lg:col-span-4 space-y-8">
                            <div className="glass p-10 rounded-[50px] border-indigo-500/20">
                                <h3 className="text-xs font-black text-white mb-10 uppercase italic tracking-widest flex items-center gap-3">
                                    <div className="w-2.5 h-2.5 bg-indigo-400 rounded-full shadow-[0_0_10px_#818cf8]"></div>
                                    Nexus Core v6
                                </h3>
                                <div className="space-y-12">
                                    <IntelItem title="50+ Ativos Monitorados" text="Varredura massiva em todos os ativos confiáveis do MB. Mais moedas significa mais chances de encontrar o gráfico perfeito." />
                                    <IntelItem title="Squeeze Detection" text="O robô identifica quando o preço está sendo comprimido (Low Volatility) antes de uma explosão iminente (High Volatility)." />
                                    <IntelItem title="Pre-Filter Tecnológico" text="Economia de processamento: apenas moedas com injeção de capital (CMF) e tendência confirmada chegam à Super IA." />
                                </div>
                            </div>

                            <div className="bg-gradient-to-br from-indigo-950/40 to-black p-10 rounded-[50px] border border-indigo-500/20 shadow-2xl text-center">
                                <div className="flex justify-center mb-6 opacity-40"><svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#818cf8" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div>
                                <h4 className="text-[10px] font-black text-slate-300 uppercase tracking-widest mb-2">Liquidez Garantida</h4>
                                <p className="text-[10px] text-slate-500 italic leading-relaxed font-medium">Análise limitada a ativos com volume orgânico real, evitando pump-and-dump em moedas sem liquidez.</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const PriceBlock = ({ label, val, color = "text-white", active = false }) => (
            <div className={`p-6 rounded-[32px] border ${active ? 'bg-indigo-600/10 border-indigo-500/40 shadow-inner' : 'bg-white/[0.02] border-white/5'} transition-all`}>
                <p className="text-[9px] font-black text-slate-500 uppercase mb-3 tracking-widest italic">{label}</p>
                <p className={`text-2xl font-mono font-bold tracking-tighter ${color}`}>{val}</p>
            </div>
        );

        const IntelItem = ({ title, text }) => (
            <div className="relative pl-8 border-l-2 border-indigo-500/20">
                <div className="absolute -left-[9px] top-0 w-4 h-4 bg-indigo-500 rounded-full border-4 border-[#030306]"></div>
                <h4 className="text-[11px] font-black text-white uppercase italic tracking-tighter">{title}</h4>
                <p className="text-[10px] text-slate-500 mt-3 leading-relaxed font-medium">{text}</p>
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
