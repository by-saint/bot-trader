<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MB Sniper Quantum Pro | Institutional Grade</title>
    <!-- Tailwind CSS para design responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM para lógica de interface -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel para compilação JSX no browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #050507; 
            color: #f8fafc;
        }
        
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Efeito de scan de rede institucional */
        .scan-line {
            height: 2px;
            background: linear-gradient(90deg, transparent, #6366f1, transparent);
            animation: scan 3s linear infinite;
            position: absolute;
            width: 100%;
            z-index: 1;
        }

        @keyframes scan {
            0% { top: -10%; opacity: 0; }
            50% { opacity: 1; }
            100% { top: 110%; opacity: 0; }
        }

        .quantum-card {
            background: rgba(15, 15, 20, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .quantum-card:hover {
            border-color: rgba(99, 102, 241, 0.4);
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -20px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- CONFIGURAÇÃO INSTITUCIONAL DO MERCADO BITCOIN ---
        const MB_WHITELIST = [
            'BTC', 'ETH', 'SOL', 'XRP', 'ADA', 'DOT', 'LINK', 'AVAX', 'MATIC', 'LTC', 
            'BCH', 'DOGE', 'SHIB', 'NEAR', 'ALGO', 'ATOM', 'UNI', 'AAVE', 'SAND',
            'MANA', 'GRT', 'CHZ', 'AXS', 'RENDER', 'FETCH', 'PEPE', 'STX', 'TIA', 'BONK', 'FLOKI'
        ];

        const ENGINE_CONFIG = {
            FEES: 0.014,            // Taxa total MB (0.7% Compra + 0.7% Venda)
            ATR_PERIOD: 14,         // Período para cálculo de volatilidade
            MIN_SCORE: 80,          // Rigor de entrada para evitar falsos sinais
            REFRESH_RATE: 60        // Segundos para novo ciclo de varredura
        };

        const App = () => {
            const [signals, setSignals] = useState([]);
            const [loading, setLoading] = useState(true);
            const [usdtBrl, setUsdtBrl] = useState(0);
            const [marketHealth, setMarketHealth] = useState('ANALYSE');
            const [countdown, setCountdown] = useState(ENGINE_CONFIG.REFRESH_RATE);
            const [isScanning, setIsScanning] = useState(false);

            // --- CÉREBRO: ANÁLISE QUANTUM DE ALTA PRECISÃO ---
            const analyzePair = (k15m, k1h) => {
                const closes = k15m.map(k => parseFloat(k[4]));
                const highs = k15m.map(k => parseFloat(k[2]));
                const lows = k15m.map(k => parseFloat(k[3]));
                const currentPrice = closes[closes.length - 1];

                // 1. Cálculo de ATR (Average True Range) para Venda Adaptativa
                let trSum = 0;
                for(let i = closes.length - ENGINE_CONFIG.ATR_PERIOD; i < closes.length; i++) {
                    const tr = Math.max(
                        highs[i] - lows[i],
                        Math.abs(highs[i] - (closes[i-1] || highs[i])),
                        Math.abs(lows[i] - (closes[i-1] || lows[i]))
                    );
                    trSum += tr;
                }
                const atr = trSum / ENGINE_CONFIG.ATR_PERIOD;

                // 2. Confluência de Médias de Fibonacci (8, 21, 55) e Trend SMA 200
                const ema8 = closes.slice(-8).reduce((a, b) => a + b, 0) / 8;
                const ema21 = closes.slice(-21).reduce((a, b) => a + b, 0) / 21;
                const sma200 = k1h.slice(-200).map(k => parseFloat(k[4])).reduce((a, b) => a + b, 0) / 200;

                // 3. Cálculo de ETA (Tempo Estimado para o Lucro)
                // Projeta a velocidade baseada na distância do ATR e momentum recente
                const targetDistance = (atr * 2.8); 
                const velocity = Math.abs(currentPrice - closes[closes.length - 10]) / 10;
                const estMinutes = Math.min(Math.round(targetDistance / (velocity || 0.0001) * 15), 480);
                
                // 4. Sistema de Pontuação (Score Quantum)
                let score = 0;
                if (currentPrice > sma200) score += 35;     // Tendência Institucional de Alta
                if (ema8 > ema21) score += 25;              // Alinhamento de Médias Fibonacci
                if (currentPrice < ema8 * 1.005) score += 20; // Comprar no Recuo (Pullback)
                
                const volCurrent = parseFloat(k15m[k15m.length - 1][5]);
                const volAvg = k15m.slice(-20).reduce((a, b) => a + parseFloat(b[5]), 0) / 20;
                if (volCurrent > volAvg * 1.4) score += 20;  // Confirmar Pressão de Compra

                return {
                    price: currentPrice,
                    target: currentPrice + targetDistance,
                    stop: currentPrice - (atr * 1.8),
                    score,
                    eta: estMinutes < 60 ? `${estMinutes}min` : `${Math.floor(estMinutes/60)}h ${estMinutes%60}min`
                };
            };

            const runEngine = useCallback(async () => {
                setIsScanning(true);
                try {
                    // Cotação do Dólar e Saúde do Bitcoin
                    const [usdtRes, btcRes] = await Promise.all([
                        fetch('https://api.binance.com/api/v3/ticker/price?symbol=USDTBRL').then(r => r.json()),
                        fetch('https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT').then(r => r.json())
                    ]);
                    
                    const dollar = parseFloat(usdtRes.price);
                    setUsdtBrl(dollar);
                    setMarketHealth(parseFloat(btcRes.priceChangePercent) < -4.0 ? 'CRÍTICO' : 'ESTÁVEL');

                    // Varredura Instantânea de Ativos
                    const tickers = await fetch('https://api.binance.com/api/v3/ticker/24hr').then(r => r.json());
                    const results = [];

                    for (const coin of MB_WHITELIST) {
                        const pair = `${coin}USDT`;
                        const ticker = tickers.find(t => t.symbol === pair);
                        if (!ticker || parseFloat(ticker.quoteVolume) < 4000000) continue;

                        const [k15, k1h] = await Promise.all([
                            fetch(`https://api.binance.com/api/v3/klines?symbol=${pair}&interval=15m&limit=100`).then(r => r.json()),
                            fetch(`https://api.binance.com/api/v3/klines?symbol=${pair}&interval=1h&limit=200`).then(r => r.json())
                        ]);

                        const analysis = analyzePair(k15, k1h);

                        if (analysis.score >= ENGINE_CONFIG.MIN_SCORE) {
                            const brlPrice = analysis.price * dollar;
                            const profitGross = (analysis.target / analysis.price) - 1;
                            
                            results.push({
                                coin,
                                score: analysis.score,
                                entryBRL: brlPrice,
                                targetBRL: analysis.target * dollar,
                                stopBRL: analysis.stop * dollar,
                                eta: analysis.eta,
                                netProfit: ((profitGross - ENGINE_CONFIG.FEES) * 100).toFixed(2)
                            });
                        }
                    }
                    setSignals(results.sort((a, b) => b.score - a.score));
                    setLoading(false);
                } catch (e) {
                    console.error("Engine Protection Triggered:", e);
                } finally {
                    setIsScanning(false);
                }
            }, []);

            useEffect(() => {
                runEngine();
                const timer = setInterval(() => setCountdown(c => c <= 1 ? ENGINE_CONFIG.REFRESH_RATE : c - 1), 1000);
                const sync = setInterval(runEngine, ENGINE_CONFIG.REFRESH_RATE * 1000);
                return () => { clearInterval(timer); clearInterval(sync); };
            }, [runEngine]);

            const format = (v) => v < 0.01 ? `R$ ${v.toFixed(8).replace('.',',')}` : v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', minimumFractionDigits: v < 1 ? 4 : 2 });

            return (
                <div className="max-w-6xl mx-auto p-4 md:p-8 relative">
                    {/* Header de Monitorização Quantum */}
                    <div className="quantum-card rounded-[40px] p-8 mb-12 flex flex-col md:flex-row justify-between items-center gap-8 relative overflow-hidden shadow-2xl">
                        <div className="scan-line"></div>
                        <div className="flex items-center gap-6 z-10">
                            <div className="w-20 h-20 bg-indigo-600 rounded-[28px] flex items-center justify-center shadow-[0_0_40px_rgba(79,70,229,0.5)] animate-pulse">
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="2.5"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>
                            </div>
                            <div>
                                <h1 className="text-4xl font-black italic tracking-tighter text-white">QUANTUM<span className="text-indigo-500">SNIPER</span></h1>
                                <div className="flex gap-5 mt-2">
                                    <span className="text-[11px] font-black uppercase tracking-widest flex items-center gap-2">
                                        <div className={`w-2.5 h-2.5 rounded-full ${marketHealth === 'ESTÁVEL' ? 'bg-emerald-500 shadow-[0_0_10px_#10b981]' : 'bg-red-500 animate-ping'}`}></div>
                                        Status: {marketHealth}
                                    </span>
                                    <span className="text-[11px] font-black text-indigo-400 uppercase tracking-widest border-l border-white/10 pl-5 flex items-center gap-2">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                                        USDT/BRL: {usdtBrl.toFixed(2)}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div className="flex items-center gap-10 z-10">
                            <div className="text-right">
                                <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-1">Cálculo de Rede</p>
                                <p className="text-5xl font-mono font-bold text-indigo-500 tabular-nums">{countdown}s</p>
                            </div>
                            <button onClick={() => {setLoading(true); runEngine();}} className={`bg-white/5 p-5 rounded-[24px] border border-white/10 hover:bg-indigo-600 transition-all active:scale-90 ${isScanning ? 'animate-spin' : ''}`}>
                                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                            </button>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                        {/* Feed Principal de Sinais */}
                        <div className="lg:col-span-8 space-y-6">
                            <div className="flex justify-between items-center px-4">
                                <h2 className="text-[11px] font-black text-slate-500 uppercase tracking-[0.5em]">Análise Institucional Ativa</h2>
                            </div>

                            {loading ? (
                                <div className="quantum-card p-40 rounded-[60px] text-center border-indigo-500/20 shadow-inner">
                                    <div className="w-14 h-14 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto mb-8"></div>
                                    <p className="text-[11px] font-black text-slate-500 tracking-[0.7em] uppercase">Sincronizando Fibonacci e ATR...</p>
                                </div>
                            ) : signals.length === 0 ? (
                                <div className="quantum-card p-32 rounded-[60px] text-center border-dashed border-white/10">
                                    <p className="text-slate-500 italic text-sm">Mercado sob análise. A aguardar confluência institucional de Score 80+.</p>
                                </div>
                            ) : (
                                signals.map((s, i) => (
                                    <div key={i} className="quantum-card rounded-[50px] p-10 group relative overflow-hidden hover:border-indigo-500/50 shadow-2xl">
                                        {/* Score Badge */}
                                        <div className="absolute top-0 right-0 p-10 text-right">
                                            <p className="text-[10px] text-slate-600 font-black uppercase mb-1 tracking-tighter">Precision Score</p>
                                            <div className="text-4xl font-black text-indigo-400">{s.score}</div>
                                        </div>

                                        <div className="flex items-center gap-8 mb-12">
                                            <div className="w-20 h-20 bg-gradient-to-br from-indigo-600 to-purple-800 rounded-[28px] flex items-center justify-center text-4xl font-black text-white shadow-2xl italic">
                                                {s.coin[0]}
                                            </div>
                                            <div>
                                                <h3 className="text-4xl font-black text-white tracking-tighter uppercase italic">{s.coin}</h3>
                                                <div className="flex gap-5 mt-3">
                                                    <span className="text-[12px] font-black text-emerald-400 uppercase tracking-widest flex items-center gap-2 bg-emerald-400/5 px-3 py-1 rounded-xl">
                                                        Lucro Líquido: +{s.netProfit}%
                                                    </span>
                                                    <span className="text-[12px] font-black text-indigo-300 uppercase tracking-widest flex items-center gap-2 bg-indigo-500/5 px-3 py-1 rounded-xl">
                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                                        ETA: {s.eta}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Cards de Preço Dinâmicos */}
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-5 mb-10">
                                            <div className="bg-black/40 p-6 rounded-[32px] border border-white/5 group-hover:bg-emerald-500/[0.03] transition-colors shadow-inner">
                                                <p className="text-[11px] font-black text-slate-500 uppercase mb-3 tracking-widest italic">Ponto de Entrada</p>
                                                <p className="text-2xl font-mono font-bold text-white tracking-tighter">{format(s.entryBRL)}</p>
                                            </div>
                                            <div className="bg-black/40 p-6 rounded-[32px] border border-indigo-500/30 group-hover:bg-indigo-500/[0.08] transition-colors shadow-inner">
                                                <p className="text-[11px] font-black text-indigo-400 uppercase mb-3 tracking-widest italic">Saída Adaptativa (ATR)</p>
                                                <p className="text-2xl font-mono font-bold text-indigo-400 tracking-tighter">{format(s.targetBRL)}</p>
                                            </div>
                                            <div className="bg-black/40 p-6 rounded-[32px] border border-white/5 group-hover:bg-red-500/[0.03] transition-colors shadow-inner">
                                                <p className="text-[11px] font-black text-slate-500 uppercase mb-3 tracking-widest italic">Proteção de Capital</p>
                                                <p className="text-2xl font-mono font-bold text-red-500 tracking-tighter">{format(s.stopBRL)}</p>
                                            </div>
                                        </div>

                                        <div className="flex justify-between items-center pt-8 border-t border-white/5">
                                            <div className="flex items-center gap-3">
                                                <div className="w-2.5 h-2.5 bg-indigo-500 rounded-full animate-pulse"></div>
                                                <span className="text-[10px] font-black text-slate-600 uppercase tracking-widest italic">Análise de Momentum em Tempo Real</span>
                                            </div>
                                            <a href={`https://www.mercadobitcoin.com.br/negociacoes/${s.coin.toLowerCase()}`} target="_blank" className="bg-white text-black font-black text-[12px] px-14 py-5 rounded-[24px] hover:bg-indigo-600 hover:text-white transition-all uppercase tracking-[0.2em] shadow-2xl active:scale-95">Abrir Ordem no MB</a>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>

                        {/* Inteligência de Mercado Lateral */}
                        <div className="lg:col-span-4 space-y-6">
                            <div className="quantum-card p-10 rounded-[50px] shadow-2xl">
                                <h3 className="text-sm font-black text-white mb-10 uppercase italic flex items-center gap-3 tracking-widest">
                                    <div className="w-2.5 h-2.5 bg-indigo-500 rounded-full animate-ping"></div>
                                    Protocolo Quantum
                                </h3>
                                <div className="space-y-10">
                                    <div className="relative pl-8 border-l-2 border-indigo-500/20">
                                        <div className="absolute -left-[9.5px] top-0 w-4.5 h-4.5 bg-indigo-500 rounded-full border-4 border-[#050507]"></div>
                                        <h4 className="text-xs font-black text-white uppercase italic tracking-tighter">Venda Adaptativa ATR</h4>
                                        <p className="text-[11px] text-slate-500 mt-3 leading-relaxed font-medium">O alvo de lucro é dinâmico. O motor mede a volatilidade das últimas 14 velas para definir o ponto onde o preço tem força estatística real para tocar.</p>
                                    </div>
                                    <div className="relative pl-8 border-l-2 border-indigo-500/20">
                                        <div className="absolute -left-[9.5px] top-0 w-4.5 h-4.5 bg-indigo-500 rounded-full border-4 border-[#050507]"></div>
                                        <h4 className="text-xs font-black text-white uppercase italic tracking-tighter">Projeção ETA</h4>
                                        <p className="text-[11px] text-slate-500 mt-3 leading-relaxed font-medium">Cálculo preditivo do tempo de operação baseado na velocidade de momentum das últimas 10 barras de negociação.</p>
                                    </div>
                                    <div className="relative pl-8 border-l-2 border-white/5">
                                        <div className="absolute -left-[9.5px] top-0 w-4.5 h-4.5 bg-slate-700 rounded-full border-4 border-[#050507]"></div>
                                        <h4 className="text-xs font-black text-white uppercase italic tracking-tighter">Anti-Crash Guard</h4>
                                        <p className="text-[11px] text-slate-500 mt-3 leading-relaxed font-medium">Monitorização da dominância do Bitcoin. Se a volatilidade negativa do BTC exceder os limites, o sistema bloqueia novos sinais.</p>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-gradient-to-br from-indigo-900/40 to-black p-10 rounded-[50px] border border-indigo-500/20 text-center shadow-2xl">
                                <div className="text-indigo-400 mb-5 flex justify-center"><svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div>
                                <h4 className="text-[12px] font-black text-white uppercase mb-3 tracking-widest italic italic">Segurança Institucional</h4>
                                <p className="text-[11px] text-slate-400 italic italic leading-relaxed">Varredura limitada a ativos com liquidez > $4M USD para garantir entradas e saídas sem derrapagem (slippage).</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
