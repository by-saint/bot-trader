<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MB Sniper Quantum-Vortex | OMNIS VISION</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        
        :root { --accent: #6366f1; --bg: #020205; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg); color: #f8fafc; overflow-x: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        .glass { background: rgba(10, 10, 15, 0.8); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.03); }
        .glow-indigo { box-shadow: 0 0 60px -15px rgba(99, 102, 241, 0.5); }
        
        .scan-bar { height: 2px; background: linear-gradient(90deg, transparent, #6366f1, transparent); width: 100%; position: absolute; z-index: 10; animation: scanning 2.5s linear infinite; }
        @keyframes scanning { 0% { top: 0; } 100% { top: 100%; } }

        .h-gradient { background: linear-gradient(135deg, #fff 20%, #6366f1 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .progress-bar { height: 4px; background: linear-gradient(90deg, #4f46e5, #818cf8); transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 0 15px #6366f1; }
        
        /* Efeito de glitch subtil para estilo tecnológico */
        .tech-card:hover { border-color: rgba(99, 102, 241, 0.5); transform: translateY(-2px); transition: all 0.3s ease; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        const apiKey = ""; // A chave é fornecida pelo ambiente

        // Whitelist expandida e focada em ativos com liquidez real no Mercado Bitcoin
        const MB_WHITELIST = [
            'BTC', 'ETH', 'SOL', 'XRP', 'ADA', 'DOT', 'LINK', 'AVAX', 'MATIC', 'LTC', 
            'BCH', 'DOGE', 'SHIB', 'NEAR', 'ALGO', 'ATOM', 'UNI', 'AAVE', 'SAND',
            'MANA', 'GRT', 'CHZ', 'AXS', 'RENDER', 'FETCH', 'PEPE', 'STX', 'TIA', 
            'BONK', 'FLOKI', 'OP', 'ARB', 'SUI', 'APT', 'IMX', 'LDO', 'FET', 'VET', 
            'FIL', 'ETC', 'INJ', 'RNDR', 'SEI', 'KAS', 'BEAM', 'GALA', 'ROSE', 'JUP',
            'PYTH', 'WIF', 'ENA', 'OAX', 'W', 'STRK', 'ZRO'
        ];

        const ENGINE_PARAMS = {
            FEE_MB: 0.014, 
            SAFETY_BUFFER: 0.005, 
            MIN_AI_CONFIDENCE: 85, // Rigoroso para precisão
            SCAN_INTERVAL: 60000 
        };

        const App = () => {
            const [signals, setSignals] = useState([]);
            const [loading, setLoading] = useState(true);
            const [usdtBrl, setUsdtBrl] = useState(0);
            const [status, setStatus] = useState('CALIBRANDO');
            const [timer, setTimer] = useState(60);
            const [progress, setProgress] = useState(0);

            // --- VALIDAÇÃO COM INTELIGÊNCIA ARTIFICIAL (OMNIS VISION) ---
            const validateWithAI = async (symbol, data, context) => {
                const prompt = `Analise Estrutural Institucional (SMC) para ${symbol}. 
                Preços (OHLCV): ${JSON.stringify(data)}. 
                Contexto Técnico: ${JSON.stringify(context)}.
                Identifique: Fair Value Gaps, Order Blocks e manipulação de liquidez.
                Responda APENAS em JSON: {"decision": "BUY" | "HOLD", "confidence": 0-100, "target_multiplier": number, "eta_minutes": number, "market_bias": "string", "reasoning": "string"}`;

                let retries = 5;
                let backoff = 1000;

                while (retries > 0) {
                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: prompt }] }],
                                generationConfig: { responseMimeType: "application/json" }
                            })
                        });
                        const result = await response.json();
                        const content = result.candidates?.[0]?.content?.parts?.[0]?.text;
                        return JSON.parse(content);
                    } catch (e) {
                        retries--;
                        if (retries === 0) return null;
                        await new Promise(r => setTimeout(r, backoff));
                        backoff *= 2;
                    }
                }
                return null;
            };

            // --- FILTRO TÉCNICO MULTI-CAMADA ---
            const performTechnicalScan = (k15, k1h) => {
                const closes = k15.map(k => parseFloat(k[4]));
                const current = closes[closes.length - 1];
                
                // 1. Tendência Institucional (SMA 200 no H1)
                const sma200 = k1h.slice(-200).reduce((a, b) => a + parseFloat(b[4]), 0) / 200;
                
                // 2. Momento Dinâmico (EMA 50 no M15)
                const ema50 = closes.slice(-50).reduce((a, b) => a + b, 0) / 50;

                // 3. Força do Fluxo (Money Flow Index Simplificado)
                const volCurrent = parseFloat(k15[k15.length - 1][5]);
                const volAvg = k15.slice(-20).reduce((a, b) => a + parseFloat(b[5]), 0) / 20;
                const volumeSpike = volCurrent > volAvg * 1.3;

                // 4. Compressão de Volatilidade (Bollinger Bands)
                const avg = closes.slice(-20).reduce((a, b) => a + b, 0) / 20;
                const stdDev = Math.sqrt(closes.slice(-20).map(x => Math.pow(x - avg, 2)).reduce((a, b) => a + b) / 20);
                const upperBB = avg + (stdDev * 2);
                const lowerBB = avg - (stdDev * 2);
                const squeeze = (upperBB - lowerBB) / avg < 0.04; // Squeeze detectado

                // Cálculo de Score Técnico para filtrar o que vai para a IA
                let score = 0;
                if (current > sma200) score += 30; // Tendência de alta macro
                if (current > ema50) score += 20;  // Momento de alta micro
                if (volumeSpike) score += 25;      // Volume institucional confirmando
                if (squeeze) score += 25;          // Preparado para explosão

                // Volatilidade para Alvos (ATR)
                const tr = k15.slice(-14).map((k, i) => {
                    const prevC = i === 0 ? parseFloat(k[3]) : parseFloat(k15[i-1][4]);
                    return Math.max(parseFloat(k[2]) - parseFloat(k[3]), Math.abs(parseFloat(k[2]) - prevC), Math.abs(parseFloat(k[3]) - prevC));
                });
                const atr = tr.reduce((a, b) => a + b, 0) / 14;

                return { current, atr, score, isCandidate: score >= 50 };
            };

            const runOmnisEngine = useCallback(async () => {
                setStatus('INICIANDO VARREDURA');
                setProgress(2);
                try {
                    const [uRes, tRes] = await Promise.all([
                        fetch('https://api.binance.com/api/v3/ticker/price?symbol=USDTBRL').then(r => r.json()),
                        fetch('https://api.binance.com/api/v3/ticker/24hr').then(r => r.json())
                    ]);
                    
                    const dollarRate = parseFloat(uRes.price);
                    setUsdtBrl(dollarRate);

                    // Filtramos apenas moedas com volume mínimo para evitar "scams" ou falta de liquidez
                    const activeTickers = tRes.filter(t => MB_WHITELIST.includes(t.symbol.replace('USDT', '')) && parseFloat(t.quoteVolume) > 2000000);
                    const identifiedSignals = [];
                    
                    for (let i = 0; i < activeTickers.length; i++) {
                        const ticker = activeTickers[i];
                        const symbol = ticker.symbol;
                        setStatus(`ANALISANDO ${symbol}`);
                        setProgress(Math.round(((i + 1) / activeTickers.length) * 100));
                        
                        // Obter dados em múltiplos timeframes
                        const [k15, k1h] = await Promise.all([
                            fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=15m&limit=100`).then(r => r.json()),
                            fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1h&limit=200`).then(r => r.json())
                        ]);

                        const techResult = performTechnicalScan(k15, k1h);

                        if (techResult.isCandidate) {
                            const aiContext = {
                                tech_score: techResult.score,
                                vol_24h: ticker.quoteVolume,
                                last_price: techResult.current
                            };
                            
                            const aiValidation = await validateWithAI(symbol, k15.slice(-20), aiContext);
                            
                            if (aiValidation && aiValidation.decision === "BUY" && aiValidation.confidence >= ENGINE_PARAMS.MIN_AI_CONFIDENCE) {
                                const targetMultiplier = aiValidation.target_multiplier || 2.4;
                                const targetPrice = techResult.current + (techResult.atr * targetMultiplier);
                                
                                // Cálculo de Lucro Líquido (Gross - Fees - Buffer)
                                const grossProfit = (targetPrice / techResult.current) - 1;
                                const netProfit = (grossProfit - ENGINE_PARAMS.FEE_MB - ENGINE_PARAMS.SAFETY_BUFFER) * 100;

                                if (netProfit > 1.0) {
                                    identifiedSignals.push({
                                        coin: symbol.replace('USDT', ''),
                                        confidence: aiValidation.confidence,
                                        priceBRL: techResult.current * dollarRate,
                                        targetBRL: targetPrice * dollarRate,
                                        stopBRL: (techResult.current - (techResult.atr * 1.5)) * dollarRate,
                                        eta: aiValidation.eta_minutes + " min",
                                        bias: aiValidation.market_bias,
                                        insight: aiValidation.reasoning,
                                        netProfit: netProfit.toFixed(2)
                                    });
                                }
                            }
                        }
                    }

                    setSignals(identifiedSignals.sort((a, b) => b.confidence - a.confidence));
                    setLoading(false);
                    setStatus('IDLE');
                } catch (e) {
                    setStatus('ERRO NO NÓ DE DADOS');
                    console.error(e);
                }
            }, []);

            useEffect(() => {
                runOmnisEngine();
                const timerId = setInterval(() => setTimer(t => t <= 1 ? 60 : t - 1), 1000);
                const syncId = setInterval(runOmnisEngine, ENGINE_PARAMS.SCAN_INTERVAL);
                return () => { clearInterval(timerId); clearInterval(syncId); };
            }, [runOmnisEngine]);

            const fmt = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', minimumFractionDigits: v < 1 ? 4 : 2 });

            return (
                <div className="max-w-7xl mx-auto p-4 lg:p-12 relative min-h-screen">
                    {/* Barra de Progresso Superior */}
                    <div className="fixed top-0 left-0 w-full z-50 h-1 bg-white/5">
                        <div className="progress-bar h-full" style={{width: `${progress}%`}}></div>
                    </div>

                    {/* Header Terminal Omnis */}
                    <div className="glass glow-indigo rounded-[40px] p-8 mb-12 relative overflow-hidden">
                        <div className="scan-bar opacity-20"></div>
                        <div className="flex flex-col lg:flex-row justify-between items-center gap-8 relative z-20">
                            <div className="flex items-center gap-6">
                                <div className="p-4 bg-indigo-600/20 rounded-2xl border border-indigo-500/30">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#6366f1" strokeWidth="2.5"><circle cx="12" cy="12" r="10"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/><path d="M2 12h20"/></svg>
                                </div>
                                <div>
                                    <h1 className="text-3xl font-black h-gradient tracking-tighter uppercase leading-none">Omnis-Vision <span className="text-white opacity-40 text-lg font-light tracking-normal">Elite Engine</span></h1>
                                    <p className="text-[10px] mono text-slate-500 uppercase tracking-[0.3em] flex items-center gap-2 mt-2">
                                        <span className="w-2 h-2 bg-indigo-500 rounded-full animate-pulse"></span>
                                        {status} | TAXA BRL: {usdtBrl.toFixed(2)}
                                    </p>
                                </div>
                            </div>
                            <div className="flex items-center gap-12">
                                <div className="text-right">
                                    <p className="text-[9px] font-bold text-slate-600 uppercase tracking-widest mb-1 italic">Recalibração</p>
                                    <p className="text-4xl font-black text-white mono leading-none">{timer}s</p>
                                </div>
                                <button onClick={() => {setLoading(true); runOmnisEngine();}} className="p-4 bg-white/5 hover:bg-white/10 rounded-2xl border border-white/10 transition-all active:scale-95 shadow-xl">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-10">
                        {/* Feed de Inteligência Principal */}
                        <div className="lg:col-span-8 space-y-8">
                            {loading ? (
                                <div className="glass p-32 rounded-[50px] text-center border-indigo-500/10 relative overflow-hidden">
                                    <div className="scan-bar opacity-10"></div>
                                    <div className="w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto mb-8"></div>
                                    <p className="text-[10px] font-black text-slate-500 tracking-[0.6em] uppercase animate-pulse">Cruzando Dados de 60+ Ativos Institucionais...</p>
                                </div>
                            ) : signals.length === 0 ? (
                                <div className="glass p-20 rounded-[50px] text-center border-dashed border-white/10 opacity-50">
                                    <p className="text-slate-500 italic text-sm">Nenhuma confluência de alta probabilidade detectada. O robô está protegendo o seu capital.</p>
                                </div>
                            ) : (
                                signals.map((s, i) => (
                                    <div key={i} className="glass tech-card rounded-[50px] p-10 relative overflow-hidden group shadow-2xl">
                                        {/* Confidence Level */}
                                        <div className="absolute top-0 right-0 p-10 text-right z-10">
                                            <div className="text-[9px] font-black text-slate-600 uppercase mb-1 tracking-tighter">Omnis Confidence</div>
                                            <div className="text-6xl font-black text-indigo-500 opacity-20 group-hover:opacity-100 transition-all italic">{s.confidence}%</div>
                                        </div>

                                        <div className="flex items-center gap-8 mb-12 relative z-10">
                                            <div className="w-20 h-20 bg-gradient-to-br from-indigo-600 to-indigo-950 rounded-[30px] flex items-center justify-center text-4xl font-black text-white shadow-2xl border border-white/10 italic">
                                                {s.coin[0]}
                                            </div>
                                            <div>
                                                <h3 className="text-5xl font-black text-white tracking-tighter uppercase italic leading-none">{s.coin}</h3>
                                                <div className="flex flex-wrap gap-4 mt-4">
                                                    <div className="bg-emerald-500/10 border border-emerald-500/20 px-4 py-2 rounded-2xl">
                                                        <span className="text-[10px] font-black text-emerald-400 uppercase tracking-widest flex items-center gap-2">
                                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
                                                            LUCRO LÍQUIDO: +{s.netProfit}%
                                                        </span>
                                                    </div>
                                                    <div className="bg-indigo-500/10 border border-indigo-500/20 px-4 py-2 rounded-2xl">
                                                        <span className="text-[10px] font-black text-indigo-400 uppercase tracking-widest flex items-center gap-2">
                                                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                                            ESTIMATIVA: {s.eta}
                                                        </span>
                                                    </div>
                                                    <div className="bg-white/5 border border-white/10 px-4 py-2 rounded-2xl">
                                                        <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest italic">
                                                            VIÉS: {s.bias}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12 relative z-10">
                                            <PriceBlock label="ENTRADA AGORA (BRL)" val={fmt(s.priceBRL)} active={true} />
                                            <PriceBlock label="ALVO INSTITUCIONAL" val={fmt(s.targetBRL)} color="text-indigo-400" />
                                            <PriceBlock label="STOP DE PROTEÇÃO" val={fmt(s.stopBRL)} color="text-red-500" />
                                        </div>

                                        <div className="flex flex-col lg:flex-row justify-between items-center gap-8 pt-10 border-t border-white/5 relative z-10">
                                            <div className="flex-1">
                                                <div className="flex items-center gap-2 mb-3">
                                                    <div className="w-2 h-2 bg-indigo-500 rounded-full shadow-lg shadow-indigo-500/50"></div>
                                                    <p className="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em]">Racional Omnis-Vision</p>
                                                </div>
                                                <p className="text-xs text-slate-400 italic leading-relaxed border-l-2 border-indigo-500/30 pl-5">"{s.insight}"</p>
                                            </div>
                                            <a href={`https://www.mercadobitcoin.com.br/negociacoes/${s.coin.toLowerCase()}`} target="_blank" className="w-full lg:w-auto bg-white text-black font-black text-xs px-16 py-6 rounded-[25px] hover:bg-indigo-600 hover:text-white transition-all uppercase tracking-[0.3em] shadow-2xl text-center active:scale-95">Executar no MB</a>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>

                        {/* Intelligence Sidebar */}
                        <div className="lg:col-span-4 space-y-8">
                            <div className="glass p-10 rounded-[50px] border-indigo-500/20 shadow-2xl">
                                <h3 className="text-xs font-black text-white mb-10 uppercase italic tracking-widest flex items-center gap-3">
                                    <div className="w-2.5 h-2.5 bg-indigo-400 rounded-full shadow-[0_0_15px_#6366f1]"></div>
                                    Omnis Protocol v7.4
                                </h3>
                                <div className="space-y-12">
                                    <IntelItem title="SMC & Liquidez" text="O robô utiliza Smart Money Concepts para identificar Fair Value Gaps e Order Blocks, onde os grandes players estão realmente posicionados." />
                                    <IntelItem title="Filtro de Ruído Absoluto" text="Apenas ativos que apresentam confluência técnica E autorização da Super IA são exibidos. Chance de acerto maximizada." />
                                    <IntelItem title="Gestão de Risco Zero-Slippage" text="Análise de volume 24h rigorosa. Entramos apenas onde há liquidez suficiente para você sair sem perdas por spread." />
                                </div>
                            </div>

                            <div className="bg-gradient-to-br from-indigo-950/50 to-black p-10 rounded-[50px] border border-indigo-500/20 shadow-2xl text-center relative overflow-hidden">
                                <div className="absolute top-0 right-0 w-32 h-32 bg-indigo-500/5 rounded-full blur-3xl"></div>
                                <div className="flex justify-center mb-6 opacity-30">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#6366f1" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                                </div>
                                <h4 className="text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] mb-3 italic">Segurança Institucional</h4>
                                <p className="text-[10px] text-slate-500 italic leading-relaxed">Varredura monitora ativamente 60+ ativos confiáveis, filtrando pump-and-dump e garantindo lucros reais.</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const PriceBlock = ({ label, val, color = "text-white", active = false }) => (
            <div className={`p-6 rounded-[35px] border ${active ? 'bg-indigo-600/10 border-indigo-500/40 shadow-inner' : 'bg-white/[0.02] border-white/5'} transition-all`}>
                <p className="text-[9px] font-black text-slate-600 uppercase mb-3 tracking-widest italic">{label}</p>
                <p className={`text-2xl font-mono font-bold tracking-tighter ${color}`}>{val}</p>
            </div>
        );

        const IntelItem = ({ title, text }) => (
            <div className="relative pl-8 border-l-2 border-indigo-500/20">
                <div className="absolute -left-[9px] top-0 w-4 h-4 bg-indigo-500 rounded-full border-4 border-[#020205]"></div>
                <h4 className="text-[11px] font-black text-white uppercase italic tracking-tighter">{title}</h4>
                <p className="text-[10px] text-slate-500 mt-4 leading-relaxed font-medium">{text}</p>
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
